{% extends 'base.html' %}

{% block title %}Employees - HRMS Lite{% endblock %}
{% block page_title %}Employees{% endblock %}

{% block header_actions %}
<a href="{% url 'hrms:employee_add' %}" class="btn btn-primary">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
    </svg>
    Add Employee
</a>
{% endblock %}

{% block content %}
<div class="employees-page">
    <!-- Search and Filter -->
    <div class="toolbar">
        <div class="search-box">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="search-icon">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input type="text" class="search-input" id="searchInput" placeholder="Search employees..."
                value="{{ search }}" autocomplete="off">
        </div>
        <div class="toolbar-info">
            <span class="count-badge">{{ total_count }} employee{{ total_count|pluralize }}</span>
        </div>
    </div>

    <!-- Employees Table -->
    {% if employees %}
    <div class="table-container">
        <table class="data-table" id="employeesTable">
            <thead>
                <tr>
                    <th>Employee ID</th>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Department</th>
                    <th>Added On</th>
                    <th class="actions-column">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for employee in employees %}
                <tr data-id="{{ employee.pk }}">
                    <td>
                        <span class="employee-id-badge">{{ employee.employee_id }}</span>
                    </td>
                    <td>
                        <div class="employee-cell">
                            <div class="employee-avatar">
                                {{ employee.full_name|slice:":1"|upper }}
                            </div>
                            <span class="employee-name">{{ employee.full_name }}</span>
                        </div>
                    </td>
                    <td>
                        <a href="mailto:{{ employee.email }}" class="email-link">{{ employee.email }}</a>
                    </td>
                    <td>
                        {% if employee.department %}
                        <span class="department-badge">{{ employee.department }}</span>
                        {% else %}
                        <span class="text-muted">—</span>
                        {% endif %}
                    </td>
                    <td>
                        <span class="date-text">{{ employee.created_at|date:"M d, Y" }}</span>
                    </td>
                    <td class="actions-column">
                        <div class="action-buttons">
                            <a href="{% url 'hrms:employee_attendance' employee.pk %}"
                                class="btn btn-icon btn-secondary" title="View Attendance">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16"
                                    height="16">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                            </a>
                            <button class="btn btn-icon btn-danger"
                                onclick="showDeleteModal('{{ employee.pk }}', '{{ employee.full_name }}')"
                                title="Delete Employee">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16"
                                    height="16">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path
                                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                    </path>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if page_obj.has_other_pages %}
    <div class="pagination">
        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if search %}&search={{ search }}{% endif %}"
            class="pagination-btn">
            ← Previous
        </a>
        {% endif %}

        <span class="pagination-info">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if search %}&search={{ search }}{% endif %}"
            class="pagination-btn">
            Next →
        </a>
        {% endif %}
    </div>
    {% endif %}

    {% else %}
    <!-- Empty State -->
    <div class="empty-state-large">
        <div class="empty-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        </div>
        {% if search %}
        <h3>No employees found</h3>
        <p>No employees match your search criteria "{{ search }}"</p>
        <a href="{% url 'hrms:employee_list' %}" class="btn btn-secondary">Clear Search</a>
        {% else %}
        <h3>No employees yet</h3>
        <p>Get started by adding your first employee to the system.</p>
        <a href="{% url 'hrms:employee_add' %}" class="btn btn-primary">Add First Employee</a>
        {% endif %}
    </div>
    {% endif %}
</div>

{% block extra_js %}
<script>
    // Search functionality
    const searchInput = document.getElementById('searchInput');
    let searchTimeout;

    searchInput.addEventListener('input', function () {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            const searchValue = this.value.trim();
            const currentUrl = new URL(window.location.href);

            if (searchValue) {
                currentUrl.searchParams.set('search', searchValue);
            } else {
                currentUrl.searchParams.delete('search');
            }
            currentUrl.searchParams.delete('page');

            window.location.href = currentUrl.toString();
        }, 500);
    });

    // Delete URL for AJAX
    function getDeleteUrl(id) {
        return "{% url 'hrms:employee_delete' 0 %}".replace('0', id);
    }
</script>
{% endblock %}
{% endblock %}