{% extends 'base.html' %}

{% block title %}Attendance Records - HRMS Lite{% endblock %}
{% block page_title %}Attendance Records{% endblock %}

{% block header_actions %}
<a href="{% url 'hrms:attendance_add' %}" class="btn btn-primary">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
    </svg>
    Mark Attendance
</a>
{% endblock %}

{% block content %}
<div class="attendance-page">
    <!-- Filter Section -->
    <div class="filter-section">
        <form method="get" class="filter-form" id="filterForm">
            <div class="filter-group">
                <label class="filter-label">Employee</label>
                {{ filter_form.employee }}
            </div>
            <div class="filter-group">
                <label class="filter-label">From Date</label>
                {{ filter_form.date_from }}
            </div>
            <div class="filter-group">
                <label class="filter-label">To Date</label>
                {{ filter_form.date_to }}
            </div>
            <div class="filter-group">
                <label class="filter-label">Status</label>
                {{ filter_form.status }}
            </div>
            <div class="filter-actions">
                <button type="submit" class="btn btn-primary btn-sm">Apply Filters</button>
                <a href="{% url 'hrms:attendance_list' %}" class="btn btn-secondary btn-sm">Clear</a>
            </div>
        </form>
    </div>

    <!-- Stats Summary -->
    <div class="attendance-summary">
        <div class="summary-item">
            <span class="summary-count">{{ total_count }}</span>
            <span class="summary-label">Total Records</span>
        </div>
        <div class="summary-item present">
            <span class="summary-count">{{ present_count }}</span>
            <span class="summary-label">Present</span>
        </div>
        <div class="summary-item absent">
            <span class="summary-count">{{ absent_count }}</span>
            <span class="summary-label">Absent</span>
        </div>
    </div>

    <!-- Attendance Table -->
    {% if attendance_records %}
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Employee</th>
                    <th>Employee ID</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Recorded On</th>
                </tr>
            </thead>
            <tbody>
                {% for record in attendance_records %}
                <tr>
                    <td>
                        <div class="employee-cell">
                            <div class="employee-avatar">
                                {{ record.employee.full_name|slice:":1"|upper }}
                            </div>
                            <a href="{% url 'hrms:employee_attendance' record.employee.pk %}"
                                class="employee-name-link">
                                {{ record.employee.full_name }}
                            </a>
                        </div>
                    </td>
                    <td>
                        <span class="employee-id-badge">{{ record.employee.employee_id }}</span>
                    </td>
                    <td>
                        <span class="date-text">{{ record.date|date:"M d, Y" }}</span>
                        <span class="day-text">{{ record.date|date:"l" }}</span>
                    </td>
                    <td>
                        <span
                            class="status-badge {% if record.status == 'present' %}status-present{% else %}status-absent{% endif %}">
                            {% if record.status == 'present' %}
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14"
                                height="14">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>
                            {% else %}
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14"
                                height="14">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="15" y1="9" x2="9" y2="15"></line>
                                <line x1="9" y1="9" x2="15" y2="15"></line>
                            </svg>
                            {% endif %}
                            {{ record.get_status_display }}
                        </span>
                    </td>
                    <td>
                        <span class="date-text small">{{ record.created_at|date:"M d, Y h:i A" }}</span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if page_obj.has_other_pages %}
    <div class="pagination">
        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}&{{ request.GET.urlencode }}" class="pagination-btn">
            ← Previous
        </a>
        {% endif %}

        <span class="pagination-info">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}&{{ request.GET.urlencode }}" class="pagination-btn">
            Next →
        </a>
        {% endif %}
    </div>
    {% endif %}

    {% else %}
    <!-- Empty State -->
    <div class="empty-state-large">
        <div class="empty-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        </div>
        <h3>No attendance records found</h3>
        {% if request.GET %}
        <p>No records match your filter criteria</p>
        <a href="{% url 'hrms:attendance_list' %}" class="btn btn-secondary">Clear Filters</a>
        {% else %}
        <p>Start tracking attendance by marking your first record</p>
        <a href="{% url 'hrms:attendance_add' %}" class="btn btn-primary">Mark Attendance</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}