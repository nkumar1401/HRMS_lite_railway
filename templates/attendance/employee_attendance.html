{% extends 'base.html' %}

{% block title %}{{ employee.full_name }} - Attendance - HRMS Lite{% endblock %}
{% block page_title %}{{ employee.full_name }} - Attendance{% endblock %}

{% block header_actions %}
<a href="{% url 'hrms:attendance_add' %}" class="btn btn-primary">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
    </svg>
    Mark Attendance
</a>
{% endblock %}

{% block content %}
<div class="employee-attendance-page">
    <!-- Employee Info Card -->
    <div class="employee-info-card">
        <div class="employee-avatar large">
            {{ employee.full_name|slice:":1"|upper }}
        </div>
        <div class="employee-details">
            <h2>{{ employee.full_name }}</h2>
            <div class="employee-meta">
                <span class="meta-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                    </svg>
                    {{ employee.employee_id }}
                </span>
                <span class="meta-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                        <polyline points="22,6 12,13 2,6"></polyline>
                    </svg>
                    {{ employee.email }}
                </span>
                {% if employee.department %}
                <span class="meta-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    {{ employee.department }}
                </span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Attendance Stats -->
    <div class="attendance-stats">
        <div class="stat-box">
            <span class="stat-number">{{ total_records }}</span>
            <span class="stat-label">Total Records</span>
        </div>
        <div class="stat-box present">
            <span class="stat-number">{{ present_days }}</span>
            <span class="stat-label">Days Present</span>
        </div>
        <div class="stat-box absent">
            <span class="stat-number">{{ absent_days }}</span>
            <span class="stat-label">Days Absent</span>
        </div>
        <div class="stat-box percentage">
            <span class="stat-number">{{ attendance_percentage }}%</span>
            <span class="stat-label">Attendance Rate</span>
        </div>
    </div>

    <!-- Date Filter -->
    <div class="filter-section compact">
        <form method="get" class="filter-form inline">
            <div class="filter-group">
                <label class="filter-label">From</label>
                <input type="date" name="date_from" value="{{ date_from }}" class="form-input filter-input">
            </div>
            <div class="filter-group">
                <label class="filter-label">To</label>
                <input type="date" name="date_to" value="{{ date_to }}" class="form-input filter-input">
            </div>
            <button type="submit" class="btn btn-primary btn-sm">Filter</button>
            {% if date_from or date_to %}
            <a href="{% url 'hrms:employee_attendance' employee.pk %}" class="btn btn-secondary btn-sm">Clear</a>
            {% endif %}
        </form>
    </div>

    <!-- Attendance Records -->
    {% if attendance_records %}
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Day</th>
                    <th>Status</th>
                    <th>Recorded</th>
                </tr>
            </thead>
            <tbody>
                {% for record in attendance_records %}
                <tr>
                    <td>
                        <span class="date-text">{{ record.date|date:"M d, Y" }}</span>
                    </td>
                    <td>
                        <span class="day-badge">{{ record.date|date:"l" }}</span>
                    </td>
                    <td>
                        <span
                            class="status-badge {% if record.status == 'present' %}status-present{% else %}status-absent{% endif %}">
                            {% if record.status == 'present' %}
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14"
                                height="14">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>
                            {% else %}
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14"
                                height="14">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="15" y1="9" x2="9" y2="15"></line>
                                <line x1="9" y1="9" x2="15" y2="15"></line>
                            </svg>
                            {% endif %}
                            {{ record.get_status_display }}
                        </span>
                    </td>
                    <td>
                        <span class="date-text small">{{ record.created_at|date:"M d, Y h:i A" }}</span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state-large">
        <div class="empty-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        </div>
        <h3>No attendance records</h3>
        {% if date_from or date_to %}
        <p>No records found for the selected date range</p>
        <a href="{% url 'hrms:employee_attendance' employee.pk %}" class="btn btn-secondary">Clear Filter</a>
        {% else %}
        <p>No attendance has been marked for this employee yet</p>
        <a href="{% url 'hrms:attendance_add' %}" class="btn btn-primary">Mark Attendance</a>
        {% endif %}
    </div>
    {% endif %}

    <!-- Back Link -->
    <div class="page-actions">
        <a href="{% url 'hrms:employee_list' %}" class="btn btn-secondary">
            ‚Üê Back to Employees
        </a>
    </div>
</div>
{% endblock %}